<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Show Me Grow</title>
  
  <link rel="stylesheet" href="css/style.css">

  <script type="module">
    // Import the functions you need from the SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyB9TwtGcDQJrJgYlcpUmtggJxvcF6MTlCk",
      authDomain: "showmegrowinfo.firebaseapp.com",
      projectId: "showmegrowinfo",
      storageBucket: "showmegrowinfo.firebasestorage.app",
      messagingSenderId: "317414799927",
      appId: "1:317414799927:web:81a6a76b52511bbad51db2"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // --- 1. HANDLE EMAILS ---
    window.submitEmail = async function (event) {
      event.preventDefault();
      const emailInput = document.getElementById("email");
      const email = emailInput.value.trim();

      if (!email) return alert("Please enter a valid email.");

      try {
        await addDoc(collection(db, "signups"), {
          email,
          timestamp: new Date()
        });
        emailInput.value = "";
        const confirmation = document.getElementById("signup-confirmation");
        confirmation.classList.add("show");
        setTimeout(() => {
          confirmation.classList.remove("show");
        }, 3000);
      } catch (e) {
        console.error("Error adding document: ", e);
        alert("Something went wrong. Try again?");
      }
    };

    // --- 2. HANDLE SPOTLIGHT STRAIN ---
    window.loadSpotlightStrain = async function() {
      const strainContainer = document.getElementById('strain-name');
      
      try {
        // Fetch all documents from the 'strains' collection
        const querySnapshot = await getDocs(collection(db, "strains"));
        const strains = [];
        
        querySnapshot.forEach((doc) => {
          strains.push(doc.data());
        });

        if (strains.length > 0) {
          // Pick a random strain
          const randomStrain = strains[Math.floor(Math.random() * strains.length)];
          
          strainContainer.innerHTML = `
            <strong>${randomStrain.name || 'Unknown Name'}</strong><br>
            <em>${randomStrain.type || 'Type Unknown'}</em><br>
            <p>${randomStrain.description || 'No description available.'}</p>
          `;
        } else {
          strainContainer.innerHTML = "No strains found in database.";
        }
      } catch (e) {
        console.error("Error fetching strains: ", e);
        strainContainer.innerHTML = "Error loading strains.";
      }
    }

    // Attach listeners
    document.addEventListener("DOMContentLoaded", () => {
        
        // Load initial strain immediately
        window.loadSpotlightStrain();
        
        const refreshBtn = document.getElementById('refresh-spotlight');
        if(refreshBtn) {
            refreshBtn.addEventListener('click', window.loadSpotlightStrain);
        }
        
        // Mailing List Toggle Logic
        const mailingListButton = document.querySelector('a[href="#signup"]');
        const signupForm = document.getElementById('signup');
        if(mailingListButton){
            mailingListButton.addEventListener('click', (e) => {
                e.preventDefault();
                signupForm.classList.toggle('active');
            });
        }
    });
  </script>
</head>

<body>

  <div class="content">
    <div class="text-container">
      <h1>Show Me Grow</h1>
      <p>Missouri Cannabis Data + Information</p>
    </div>
  </div>

  <div class="spotlight">
    <h2>Spotlight Strain</h2>
    <div id="strain-name">Loading...</div>
    <br>
    <button id="refresh-spotlight">Refresh Spotlight</button>
  </div>

  <div class="button-group">
    <a href="mailto:cb@showmegrow.info" class="button">Email Us</a>
    <a href="#signup" class="button">Join Mailing List</a>
  </div>

  <div id="signup" class="signup-form">
    <form onsubmit="submitEmail(event)">
      <input id="email" type="email" placeholder="Your email" required />
      <button type="submit">Notify Me</button>
    </form>
  </div>
  
  <div id="signup-confirmation" class="confirmation-popup">Thanks! Youâ€™ll be notified.</div>

</body>
</html>
